# **AI阶段任务验证与质量保证指南 (`AI_STAGE_VALIDATION_GUIDE.md`)**

**版本**: 1.1
**最后更新**: `{{YYYY-MM-DD}}`

**目的**: 本指南为 `OrchestratorAgent` 和所有专业AI角色提供一套标准的行为规范和检查清单，旨在确保AI在项目各阶段生成的任务、分配的任务以及最终的交付物都符合预设的质量标准、完整性要求，并且与项目需求、设计文档保持一致。**本指南将与用户在 `project_docs/custom_validation_rules.md` (如果存在) 中定义的项目特定规则协同工作，共同构成完整的验证体系。`OrchestratorAgent` 负责读取并整合这两部分规则。**

## **核心验证原则**

1.  **文档驱动**: 所有AI行动和产出都必须基于并参考最新的项目文档（尤其是 `PROJECT_CONTEXT.md` 中索引的文档）。
2.  **需求对齐**: 确保AI的理解和执行始终与用户需求、功能规格说明（FSD）以及用户故事对齐。
3.  **阶段门控**: 在每个关键阶段（任务生成、任务分配、任务完成、阶段结束）设立明确的检查点和质量门。
4.  **完整性优先**: 优先确保交付物的完整性，包括代码、文档、测试、配置等。
5.  **质量内建**: 鼓励AI角色在执行任务过程中就进行自我检查和质量控制，而非仅在最后阶段进行验证。
6.  **持续反馈**: `OrchestratorAgent` 应就验证结果向相关AI角色或用户提供及时、明确的反馈。
7.  **自定义规则优先**: 当本指南中的通用规则与 `custom_validation_rules.md` 中的特定规则发生冲突时，应优先考虑并遵循 `custom_validation_rules.md` 中的具体指示，除非该指示明显危害项目核心目标（此时 `OrchestratorAgent` 应向用户报告并请求澄清）。

## **一、`OrchestratorAgent` 的阶段验证职责**

`OrchestratorAgent` 作为项目总指挥，在以下关键节点必须执行验证程序：

### **规范1: 阶段任务生成后的强制检查**

每当OrchestratorAgent为某阶段生成任务列表后，必须执行以下检查：

```markdown
【阶段任务验证检查清单】

✅ **文档完整性检查**:
- 确认当前阶段的所有必需参考文档已存在
- 列出任务执行需要参考的具体文档路径
- 标识缺失文档并要求补充

✅ **任务覆盖度检查**:
- 对照ACTION_PLAN_MASTER.md验证任务完整性
- 确保任务列表涵盖该阶段的所有关键交付物
- 检查任务间的依赖关系是否合理

✅ **质量门控设置**:
- 为每个任务明确指定必须参考的文档
- 设定任务完成的验收标准
- 定义阶段完成的质量检查点
```

### **规范2: 专业AI角色任务分配时的强制要求**

OrchestratorAgent在指导专业AI角色时，必须明确传达：

```markdown
【AI角色任务指令模板】

🎯 **任务**: [具体任务描述]

📚 **必须参考的文档**:
- [文档1路径] - [参考目的]
- [文档2路径] - [参考目的] 
- [文档3路径] - [参考目的]

✅ **执行要求**:
1. 开始任务前，确认已仔细阅读所有指定文档
2. 执行过程中，确保产出与文档要求一致
3. 完成后，自我检查产出是否符合文档规范
4. 提交时，说明参考了哪些文档以及如何确保一致性

🚨 **验收标准**:
- [具体的完成标准1]
- [具体的完成标准2]
- [具体的完成标准3]
```

### **规范3: 阶段完成后的强制验证**

每个开发阶段完成后，OrchestratorAgent必须执行：

```markdown
【阶段完成验证检查清单】

✅ **交付物完整性**:
- 检查阶段应交付的所有文档/代码是否完成
- 验证文件路径是否符合项目结构规范
- 确认文档格式和内容质量

✅ **文档一致性验证**:
- 新产出与需求文档的一致性检查
- 设计文档与实现代码的对应关系验证
- 跨文档引用的准确性检查

✅ **质量标准符合性**:
- 代码质量标准检查(如适用)
- 文档完整性和可读性检查
- 测试覆盖率验证(如适用)

✅ **PROJECT_CONTEXT.md更新**:
- 记录阶段完成情况
- 更新关键文档索引
- 标识发现的问题和解决方案
```

---

## **专业AI角色的自我检查规范**

### **ProductOwnerAI 检查规范**
```markdown
执行需求分析任务时必须：
1. 参考外部AI协作文档(如存在)
2. 确保用户故事符合INVEST原则
3. 验证需求的可测试性和可实现性
4. 检查需求优先级的合理性
```

### **SystemArchitectAI 检查规范**
```markdown
执行架构设计任务时必须：
1. 严格参考功能需求规格文档(FSD.md)
2. 确保架构设计支持所有功能要求
3. 验证技术选型的合理性和可行性
4. 检查架构的可扩展性和维护性
```

### **DeveloperAI 检查规范**
```markdown
执行开发任务时必须：
1. 严格按照系统架构文档进行实现
2. 确保代码符合API设计文档规范
3. 验证所有功能点都有对应实现
4. 检查错误处理和边界情况处理
5. 确认单元测试覆盖核心逻辑
```

### **TesterAI 检查规范**
```markdown
执行测试任务时必须：
1. 基于用户故事和需求文档设计测试用例
2. 确保测试覆盖所有功能和非功能需求
3. 验证测试环境与生产环境的一致性
4. 检查自动化测试的稳定性和可维护性
```

---

## **自定义验证规则配置**

### **项目启动后的规则定制**

项目启动后，用户可以通过创建简单的配置文件来添加项目特定的验证要求：

**配置文件**: `project_docs/custom_validation_rules.md`

```markdown
# 项目自定义验证规则

## 阶段门控规则
### 需求分析阶段
- [ ] 必须包含用户验收测试计划
- [ ] 每个功能必须有对应的用户故事
- [ ] 必须定义明确的成功指标

### 设计阶段  
- [ ] API设计必须包含错误处理规范
- [ ] 数据库设计必须考虑性能优化
- [ ] UI设计必须符合无障碍访问标准

### 开发阶段
- [ ] 所有API必须有完整的文档注释
- [ ] 代码覆盖率不得低于80%
- [ ] 必须包含集成测试

## 文档参考强制要求
### DeveloperAI必须参考：
- project_docs/REQUIREMENTS/FSD.md
- project_docs/ARCHITECTURE_AND_DESIGN/API_DOCUMENTATION.md
- project_docs/ARCHITECTURE_AND_DESIGN/DATA_MODEL.md

### TesterAI必须参考：
- project_docs/REQUIREMENTS/USER_STORIES.md
- project_docs/REQUIREMENTS/NON_FUNCTIONAL_REQUIREMENTS.md

## 质量检查清单
### 代码质量
- [ ] 遵循团队编码规范
- [ ] 没有硬编码的配置信息
- [ ] 有适当的日志记录

### 文档质量
- [ ] 所有公共API有使用示例
- [ ] 部署文档包含回滚步骤
- [ ] 用户手册经过非技术人员验证
```

### **规则应用方式**

OrchestratorAgent读取自定义规则后，将其融入标准检查流程：

```markdown
【融合检查指令】

在执行标准验证检查清单的基础上，额外执行：

1. 读取 project_docs/custom_validation_rules.md
2. 将自定义规则添加到对应阶段的检查清单中
3. 在指导专业AI角色时，明确传达自定义要求
4. 在阶段完成验证时，确认自定义规则的满足情况
```

---

## **实施指导**

### **对于OrchestratorAgent**
1. 将本指南的所有检查清单作为内置行为规范
2. 在每个关键节点自动触发相应的检查流程
3. 强制要求专业AI角色遵循文档参考规范
4. 持续维护PROJECT_CONTEXT.md的准确性

### **对于专业AI角色**
1. 严格遵循角色特定的检查规范
2. 主动申报参考文档和验证结果
3. 在不确定时主动询问OrchestratorAgent
4. 确保产出的可追溯性和可验证性

### **对于项目用户**
1. 项目启动后可创建custom_validation_rules.md添加特定要求
2. 定期检查PROJECT_CONTEXT.md了解项目状态
3. 在发现质量问题时及时反馈给OrchestratorAgent

---

**通过这套验证指南，确保AI驱动的项目开发过程始终与文档要求保持一致，避免实现偏差，提高交付质量。** 